!function(a){"use strict";var b=a.module("app",["ngAnimate","ngRoute","ngSanitize","ng-currency"]);b.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/wallet.html",controller:"WalletCtrl"}).otherwise({redirectTo:"/"})}])}(window.angular),function(a){"use strict";var b=a.module("app");b.factory("TransactionsService",["$rootScope","$window","$q","$log",function(b,c,d,e){function f(){var b;try{var f=c.localStorage.getItem(k);b=JSON.parse(f)}catch(g){e.error(g),b=null}return b&&a.isObject(b)&&a.isArray(b.transactions)&&a.isNumber(b.total)||(b={transactions:[],total:0}),d.when(b)}function g(a){try{var b=JSON.stringify(a);c.localStorage.setItem(k,b)}catch(f){e.error(f),a={transactions:[],total:0}}return d.when(a)}function h(a){return f().then(function(b){return a<-b.total?d.reject("Insufficient funds"):(b.total+=a,b.transactions.push({id:b.transactions.length+1,date:+new Date,"in":Math.max(a,0),out:Math.min(a,0),runningTotal:b.total}),g(b).then(function(a){return a},function(a){return d.reject("could not store wallet: "+a)}))})}function i(a){return h(a)}function j(a){return h(-a)}var k="WALLET",l={getWallet:f,addMoney:i,removeMoney:j};return b.$on("RESET",function(){c.localStorage.removeItem(k)}),l}])}(window.angular),function(a){"use strict";var b=a.module("app");b.controller("HeaderCtrl",["$scope","$rootScope",function(a,b){a.reset=function(){b.$broadcast("RESET")}}])}(window.angular),function(a,b){"use strict";var c=a.module("app");c.controller("WalletCtrl",["$scope","$rootScope","$timeout","$log","TransactionsService",function(a,c,d,e,f){function g(){a.newTransaction=0,a.loading=!0,a.error=null,f.getWallet().then(j,k)["finally"](function(){a.loading=!1,l()})}function h(b){a.loading=!0,a.error=null,f.addMoney(b).then(j,k)["finally"](function(){a.loading=!1,l()})}function i(b){a.loading=!0,a.error=null,f.removeMoney(b).then(j,k)["finally"](function(){a.loading=!1,l()})}function j(b){a.transactions=b.transactions,a.total=b.total}function k(b){e.error(b),a.error=b}function l(){d(function(){a.newTransaction=0,b("#wallet-input").focus()},100)}a.addMoney=h,a.removeMoney=i,g(),c.$on("RESET",function(){d(g,0)})}])}(window.angular,window.jQuery),function(a){"use strict";var b=a.module("app");b.directive("selectOnFocus",function(){return{restrict:"A",link:function(a,b){b.on("click",function(){this.setSelectionRange(0,this.value.length)})}}})}(window.angular),angular.module("app").run(["$templateCache",function(a){"use strict";a.put("views/wallet.html",'<div class="jumbotron"> <h1>My Wallet</h1> <form class="form-inline"> <div class="form-group"> <div class="input-group"> <div class="input-group-addon">$</div> <input id="wallet-input" type="text" class="form-control" ng-model="newTransaction" ng-currency="true" min="0" select-on-focus> </div> </div> <button type="button" class="btn btn-sm btn-primary" ng-disabled="!newTransaction" ng-click="addMoney(newTransaction)">Put In</button> <button type="button" class="btn btn-sm btn-primary" ng-disabled="!newTransaction" ng-click="removeMoney(newTransaction)">Take Out</button> <div ng-if="error" class="alert alert-danger" role="alert" ng-bind="error"></div> </form> </div> <div class="transactions"> <h4>Transactions:</h4> <table class="table table-striped"> <thead> <tr> <th class="text-center">#</th> <th class="text-left">Time</th> <th class="text-right">In</th> <th class="text-right">Out</th> <th class="text-right">Running Total</th> </tr> </thead> <tfoot> <tr> <td class="text-right" colspan="4">Total:</td> <td class="text-right" ng-bind="total | currency"></td> </tr> </tfoot> <tbody> <tr ng-repeat="transaction in transactions.slice().reverse()"> <td class="text-center" ng-bind="::transaction.id"></td> <td class="text-left" ng-bind="::transaction.date | date:\'yyyy-MM-dd HH:mm:ss\'"></td> <td class="text-right" ng-if="transaction.in" ng-bind="::transaction.in | currency"></td> <td class="text-right" ng-if="!transaction.in">-</td> <td class="text-right" ng-if="transaction.out" ng-bind="::transaction.out | currency"></td> <td class="text-right" ng-if="!transaction.out">-</td> <td class="text-right" ng-bind="::transaction.runningTotal | currency"></td> </tr> <tr> <td colspan="5" ng-if="!transactions.length">---</td> </tr> </tbody> </table> </div>')}]);